/*! media-credit media-credit-image-properties.js 2019-05-19 6:51:01 PM */

!function(e,t){"use strict";var a,u,g=mundschenk.mediaCredit||{};t.media.events&&(a=t.Backbone.View.extend({className:"advanced-media-credit",template:t.media.template("media-credit-image-properties"),initialize:function(){t.Backbone.View.prototype.initialize.apply(this,arguments)},prepare:function(){return this.model.toJSON()},render:function(){return t.Backbone.View.prototype.render.apply(this,arguments),this}}),t.media.events.on("editor:frame-create",function(e){(u=e.frame).on("content:render:image-details",function(e){var t=new a({model:e.model});e.on("post-render",function(){e.views.insert(e.$el.find(".advanced-settings"),t.render().el,{at:1}),g.autoComplete(t,'input[data-setting="mediaCreditText"]',!1)})})}),t.media.events.on("editor:image-edit",function(e){""===e.metadata.mediaCreditText&&""!==e.metadata.mediaCreditAuthorID&&(e.metadata.mediaCreditText=g.id[e.metadata.mediaCreditAuthorID])}),t.media.events.on("editor:image-update",function(e){var t,a,i,d=e.editor.dom,r=e.image,n=u.content.get().model,o=n.get("align"),m=n.get("width"),c=n.get("mediaCreditText"),p=n.get("mediaCreditAuthorID"),s=n.get("mediaCreditLink"),l=n.get("mediaCreditNoFollow");a=r.parentNode&&"A"===r.parentNode.nodeName?d.getNext(r.parentNode,".mceMediaCreditTemp"):d.getNext(r,".mceMediaCreditTemp"),g.id[p]!==c&&(p=""),t=(t=p?g.id[p]+g.separator+g.organization:c).replace(/<[^>]+>(.*)<\/[^>]+>/g,"$1"),o="align"+(o||"none"),null===a&&(c||p)&&(a=d.create("span",{class:"mceMediaCreditTemp mceNonEditable","data-media-credit-author-id":p,"data-media-credit-text":c,"data-media-credit-align":o,"data-media-credit-link":s,"data-media-credit-nofollow":l},t),r.parentNode&&"A"===r.parentNode.nodeName?d.insertAfter(a,r.parentNode):d.insertAfter(a,r)),a&&(d.getParent(a,"dl.wp-caption")||(i=d.create("div",{class:"mceMediaCreditOuterTemp "+o,style:"width: "+(parseInt(m,10)+10)+"px"}),d.insertAfter(i,a.parentNode),d.add(i,a.parentNode),d.remove(a.parentNode,!0)),d.setAttrib(a,"data-media-credit-text",c),d.setAttrib(a,"data-media-credit-author-id",p),d.setAttrib(a,"data-media-credit-link",s),d.setAttrib(a,"data-media-credit-nofollow",l),d.setHTML(a,t))}))}(jQuery,wp);